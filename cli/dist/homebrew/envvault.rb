# Homebrew Formula for EnvVault CLI
# This file is auto-generated by CI/CD on release

class Envvault < Formula
  desc "Secure, local-first environment variable management"
  homepage "https://envault.net"
  version "VERSION_PLACEHOLDER"
  license "MIT"

  on_macos do
    if Hardware::CPU.arm?
      url "https://github.com/dj-pearson/vault-verse/releases/download/vVERSION_PLACEHOLDER/envvault-darwin-arm64"
      sha256 "SHA256_ARM64_PLACEHOLDER"
    else
      url "https://github.com/dj-pearson/vault-verse/releases/download/vVERSION_PLACEHOLDER/envvault-darwin-amd64"
      sha256 "SHA256_AMD64_PLACEHOLDER"
    end
  end

  on_linux do
    if Hardware::CPU.arm?
      url "https://github.com/dj-pearson/vault-verse/releases/download/vVERSION_PLACEHOLDER/envvault-linux-arm64"
      sha256 "SHA256_LINUX_ARM64_PLACEHOLDER"
    else
      url "https://github.com/dj-pearson/vault-verse/releases/download/vVERSION_PLACEHOLDER/envvault-linux-amd64"
      sha256 "SHA256_LINUX_AMD64_PLACEHOLDER"
    end
  end

  def install
    bin.install "envvault-#{OS.kernel_name.downcase}-#{Hardware::CPU.arch}" => "envvault"

    # Generate shell completions
    output = Utils.safe_popen_read("#{bin}/envvault", "completion", "bash")
    (bash_completion/"envvault").write output

    output = Utils.safe_popen_read("#{bin}/envvault", "completion", "zsh")
    (zsh_completion/"_envvault").write output

    output = Utils.safe_popen_read("#{bin}/envvault", "completion", "fish")
    (fish_completion/"envvault.fish").write output
  end

  test do
    system "#{bin}/envvault", "--version"
    assert_match "envvault version", shell_output("#{bin}/envvault --version")
  end
end
